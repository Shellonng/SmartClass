# ğŸ¤ è¯­éŸ³è¯†åˆ«ç‰¹å¾æ ¼å¼

## ğŸ“Š SpeechProcessor è¾“å‡ºæ ¼å¼

### **å®Œæ•´è¾“å‡ºç»“æ„**

```python
# è°ƒç”¨è¯­éŸ³è¯†åˆ«
from models.speech_processor import SpeechProcessor

processor = SpeechProcessor(config)
result = processor.transcribe_with_analysis("audio.wav")

# è¿”å›çš„resultå­—å…¸ç»“æ„ï¼š
{
    "text": "å—¯...æˆ‘ç”¨è¿‡Redisï¼Œå—¯...ä¸»è¦æ˜¯åšç¼“å­˜ï¼Œç„¶å...å°±æ˜¯ç¼“å­˜ç”¨æˆ·sessionã€‚",
    
    "filler_count": 5,  # å¡«å……è¯æ€»æ•°
    
    "filler_positions": [0.2, 1.8, 3.5, 4.2, 5.1],  # å¡«å……è¯å‡ºç°çš„æ—¶é—´ç‚¹ï¼ˆç§’ï¼‰
    
    "filler_words_found": ["å—¯", "ç„¶å", "å°±æ˜¯"],  # å…·ä½“å‡ºç°çš„å¡«å……è¯
    
    "hesitation_score": 0.75,  # çŠ¹è±«åº¦è¯„åˆ†ï¼ˆ0-1ï¼Œè¶Šé«˜è¶ŠçŠ¹è±«ï¼‰
    
    "speech_rate": 2.5,  # è¯­é€Ÿï¼ˆå­—/ç§’ï¼‰
    
    "pauses": [1.8, 2.3],  # é•¿åœé¡¿æ—¶é•¿åˆ—è¡¨ï¼ˆç§’ï¼‰
    
    "confidence": 0.92,  # Whisperè¯†åˆ«ç½®ä¿¡åº¦
    
    "segments": [  # Whisperåˆ†æ®µç»“æœï¼ˆå¯é€‰ï¼‰
        {
            "start": 0.0,
            "end": 2.5,
            "text": "å—¯...æˆ‘ç”¨è¿‡Redis",
            "words": [
                {"word": "å—¯", "start": 0.0, "end": 0.5},
                {"word": "æˆ‘", "start": 0.8, "end": 1.0},
                {"word": "ç”¨è¿‡", "start": 1.0, "end": 1.5},
                {"word": "Redis", "start": 1.5, "end": 2.5}
            ]
        },
        {
            "start": 2.5,
            "end": 5.0,
            "text": "ä¸»è¦æ˜¯åšç¼“å­˜",
            "words": [...]
        }
    ]
}
```

---

## ğŸ¯ å„ç‰¹å¾çš„å«ä¹‰

### **1. filler_countï¼ˆå¡«å……è¯æ•°é‡ï¼‰**

**å®šä¹‰**ï¼šè¯†åˆ«å‡ºçš„å¡«å……è¯æ€»æ•°

**å¡«å……è¯åˆ—è¡¨**ï¼ˆæ¥è‡ªconfig.yamlï¼‰ï¼š
```python
filler_words = [
    "å—¯", "å‘ƒ", "é¢", "è¿™ä¸ª", "é‚£ä¸ª", 
    "å°±æ˜¯", "ç„¶å", "emm", "å•Š", "å‘€"
]
```

**ç¤ºä¾‹**ï¼š
```
æ–‡æœ¬ï¼š"å—¯...æˆ‘ç”¨è¿‡Redisï¼Œå—¯...å°±æ˜¯åšç¼“å­˜"
filler_count: 3  # "å—¯"x2 + "å°±æ˜¯"x1
```

### **2. filler_positionsï¼ˆå¡«å……è¯ä½ç½®ï¼‰**

**å®šä¹‰**ï¼šæ¯ä¸ªå¡«å……è¯å‡ºç°çš„æ—¶é—´ç‚¹ï¼ˆç§’ï¼‰

**ç¤ºä¾‹**ï¼š
```
audio: |----å—¯---|--æ–‡æœ¬--|--å—¯--|--å°±æ˜¯--|--æ–‡æœ¬--|
time:  0   0.5    1.0     2.0    3.0     4.0
       â†“                  â†“      â†“
filler_positions: [0.5, 2.0, 3.0]
```

**ç”¨é€”**ï¼š
- åˆ¤æ–­å¡«å……è¯åˆ†å¸ƒï¼ˆé›†ä¸­ vs åˆ†æ•£ï¼‰
- æ£€æµ‹"å¡å£³ç‚¹"

### **3. filler_words_foundï¼ˆå…·ä½“å¡«å……è¯ï¼‰**

**å®šä¹‰**ï¼šå‡ºç°äº†å“ªäº›å¡«å……è¯

**ç¤ºä¾‹**ï¼š
```
æ–‡æœ¬ï¼š"å—¯...æˆ‘å—¯...å°±æ˜¯...é‚£ä¸ª..."
filler_words_found: ["å—¯", "å°±æ˜¯", "é‚£ä¸ª"]
```

**ç”¨é€”**ï¼š
- ä¸åŒå¡«å……è¯è¡¨ç¤ºä¸åŒç¨‹åº¦çš„çŠ¹è±«
- "å—¯ã€å‘ƒ" > "å°±æ˜¯ã€ç„¶å"

### **4. hesitation_scoreï¼ˆçŠ¹è±«åº¦ï¼‰**

**å®šä¹‰**ï¼šç»¼åˆè¯„åˆ†ï¼Œ0-1ä¹‹é—´
- 0 = éå¸¸æµç•…
- 1 = éå¸¸çŠ¹è±«

**è®¡ç®—å…¬å¼**ï¼š
```python
hesitation_score = (
    filler_density * 0.4 +    # å¡«å……è¯å¯†åº¦
    speech_rate_score * 0.3 + # è¯­é€Ÿæ˜¯å¦è¿‡æ…¢
    pause_score * 0.3         # åœé¡¿æƒ…å†µ
)
```

**åˆ†çº§**ï¼š
| åˆ†æ•° | ç­‰çº§ | è¡¨ç° |
|------|------|------|
| 0.0-0.3 | æµç•… | å›ç­”è‡ªä¿¡ã€è¿è´¯ |
| 0.3-0.5 | ä¸€èˆ¬ | æœ‰å°‘é‡çŠ¹è±« |
| 0.5-0.7 | çŠ¹è±« | æ˜æ˜¾ä¸ç¡®å®š |
| 0.7-1.0 | å¾ˆçŠ¹è±« | å¯èƒ½ç­”ä¸ä¸Šæ¥ |

### **5. speech_rateï¼ˆè¯­é€Ÿï¼‰**

**å®šä¹‰**ï¼šè¯´è¯é€Ÿåº¦ï¼ˆå­—/ç§’ï¼‰

**å‚è€ƒå€¼**ï¼š
- æ­£å¸¸è¯­é€Ÿï¼š3-5 å­—/ç§’
- è¿‡å¿«ï¼š> 6 å­—/ç§’
- è¿‡æ…¢ï¼š< 2.5 å­—/ç§’ï¼ˆå¯èƒ½åœ¨æ€è€ƒï¼‰

**ç¤ºä¾‹**ï¼š
```
æ–‡æœ¬ï¼š"æˆ‘ç”¨è¿‡Redisåšç¼“å­˜"ï¼ˆ8ä¸ªå­—ï¼‰
æ—¶é•¿ï¼š3ç§’
speech_rate: 8/3 = 2.67 å­—/ç§’ï¼ˆåæ…¢ï¼Œå¯èƒ½åœ¨æ€è€ƒï¼‰
```

### **6. pausesï¼ˆåœé¡¿åˆ—è¡¨ï¼‰**

**å®šä¹‰**ï¼šé•¿åœé¡¿ï¼ˆ> 1.5ç§’ï¼‰çš„æ—¶é•¿

**ç¤ºä¾‹**ï¼š
```
audio: è¯´è¯--[é™éŸ³2ç§’]--è¯´è¯--[é™éŸ³1.8ç§’]--è¯´è¯
pauses: [2.0, 1.8]
```

**ç”¨é€”**ï¼š
- æ£€æµ‹"å¡å£³"
- å¤šä¸ªé•¿åœé¡¿ â†’ ä¸ç¡®å®š

---

## ğŸ“ åœ¨BERTè®­ç»ƒæ•°æ®ä¸­ä½¿ç”¨

### **æ ‡å‡†æ ¼å¼**

```json
{
  "question": "ä½ ç”¨è¿‡Rediså—ï¼Ÿ",
  "answer": "å—¯...æˆ‘ç”¨è¿‡ï¼Œå—¯...ä¸»è¦æ˜¯åšç¼“å­˜ï¼Œç„¶å...å°±æ˜¯ç¼“å­˜sessionã€‚",
  "context": {
    "follow_up_depth": 1,
    
    // ===== è¯­éŸ³ç‰¹å¾ï¼ˆæ¥è‡ªSpeechProcessorï¼‰ =====
    "hesitation_score": 0.65,      // çŠ¹è±«åº¦ï¼ˆå…³é”®ç‰¹å¾ï¼‰
    "filler_count": 5,              // å¡«å……è¯æ•°é‡
    "filler_words": ["å—¯", "ç„¶å", "å°±æ˜¯"],  // å…·ä½“å¡«å……è¯
    "filler_density": 0.15,         // å¡«å……è¯å¯†åº¦ï¼ˆå¯é€‰ï¼‰
    "speech_rate": 2.8,             // è¯­é€Ÿï¼ˆå¯é€‰ï¼‰
    "pause_count": 2,               // åœé¡¿æ¬¡æ•°ï¼ˆå¯é€‰ï¼‰
    "long_pauses": [1.8, 2.1],      // é•¿åœé¡¿æ—¶é•¿ï¼ˆå¯é€‰ï¼‰
    
    // ===== æ–‡æœ¬ç‰¹å¾ =====
    "answer_length": 45,            // å›ç­”é•¿åº¦
    "has_negative_words": true      // æ˜¯å¦åŒ…å«"ä¸ä¼š"ç­‰
  },
  "label": "NEXT_TOPIC",
  "reason": "è™½ç„¶å€™é€‰äººè¯´ç”¨è¿‡ï¼Œä½†hesitation_score=0.65ä¸”å¤šä¸ªå¡«å……è¯ï¼Œæ˜¾ç¤ºä¸ç¡®å®šï¼Œåº”è¯¥æ¢è¯é¢˜"
}
```

---

## ğŸ¯ çœŸå®æ¡ˆä¾‹ç¤ºä¾‹

### **æ¡ˆä¾‹1ï¼šæµç•…å›ç­”ï¼ˆFOLLOW_UPï¼‰**

```json
{
  "question": "ä½ ç”¨è¿‡Rediså—ï¼Ÿ",
  "answer": "ç”¨è¿‡ï¼Œæˆ‘åœ¨é¡¹ç›®ä¸­ç”¨Redisåšç¼“å­˜ï¼Œä¸»è¦ç¼“å­˜ç”¨æˆ·sessionå’Œçƒ­ç‚¹æ•°æ®ã€‚",
  "context": {
    "follow_up_depth": 1,
    "hesitation_score": 0.15,       // â† æµç•…
    "filler_count": 1,              // â† ä»…1ä¸ªå¡«å……è¯
    "filler_words": ["å°±æ˜¯"],
    "speech_rate": 4.2,             // â† æ­£å¸¸è¯­é€Ÿ
    "pause_count": 0,               // â† æ— é•¿åœé¡¿
    "long_pauses": [],
    "answer_length": 45
  },
  "label": "FOLLOW_UP",
  "reason": "å›ç­”æµç•…ã€æœ‰å†…å®¹ï¼Œå¯ä»¥è¿½é—®"
}
```

**å¯¹åº”çš„å®é™…éŸ³é¢‘**ï¼š
```
æ—¶é—´è½´ï¼š|--ç”¨è¿‡--|--æˆ‘åœ¨é¡¹ç›®ä¸­--|--ç”¨Redis--|--åšç¼“å­˜--|--ä¸»è¦æ˜¯--|--...|
å¡«å……è¯ï¼šæ— 
åœé¡¿ï¼š  æ— 
è¯„ä¼°ï¼š  âœ… è‡ªä¿¡ã€æµç•…
```

### **æ¡ˆä¾‹2ï¼šæ˜æ˜¾çŠ¹è±«ï¼ˆNEXT_TOPICï¼‰**

```json
{
  "question": "ä½ äº†è§£Redisçš„æŒä¹…åŒ–æœºåˆ¶å—ï¼Ÿ",
  "answer": "å—¯...è¿™ä¸ª...æˆ‘å¥½åƒ...å—¯...ä¸å¤ªæ¸…æ¥šï¼Œé¢...å°±æ˜¯...çŸ¥é“ä¸€ç‚¹ç‚¹ã€‚",
  "context": {
    "follow_up_depth": 2,
    "hesitation_score": 0.85,       // â† å¾ˆçŠ¹è±«
    "filler_count": 8,              // â† å¤§é‡å¡«å……è¯
    "filler_words": ["å—¯", "è¿™ä¸ª", "é¢", "å°±æ˜¯"],
    "speech_rate": 2.1,             // â† è¯­é€Ÿæ…¢
    "pause_count": 3,               // â† å¤šæ¬¡åœé¡¿
    "long_pauses": [2.5, 1.8, 2.0], // â† é•¿æ—¶é—´æ€è€ƒ
    "answer_length": 30
  },
  "label": "NEXT_TOPIC",
  "reason": "hesitation_scoreé«˜è¾¾0.85ï¼Œå¤§é‡å¡«å……è¯å’Œåœé¡¿ï¼Œæ˜æ˜¾ç­”ä¸ä¸Šæ¥ï¼Œåº”è¯¥æ¢è¯é¢˜"
}
```

**å¯¹åº”çš„å®é™…éŸ³é¢‘**ï¼š
```
æ—¶é—´è½´ï¼š|-å—¯-[åœ2.5s]-è¿™ä¸ª-[åœ1.8s]-æˆ‘å¥½åƒ-å—¯-ä¸å¤ªæ¸…æ¥š-...|
å¡«å……è¯ï¼šå—¯ã€è¿™ä¸ªã€å—¯ã€é¢ã€å°±æ˜¯ï¼ˆ8ä¸ªï¼‰
åœé¡¿ï¼š  3æ¬¡é•¿åœé¡¿ï¼ˆ2.5s, 1.8s, 2.0sï¼‰
è¯„ä¼°ï¼š  âŒ æ˜æ˜¾ä¸ä¼š
```

### **æ¡ˆä¾‹3ï¼šæœ‰å¡«å……è¯ä½†å†…å®¹å¥½ï¼ˆFOLLOW_UPï¼‰**

```json
{
  "question": "ä½ æ˜¯æ€ä¹ˆè®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´çš„ï¼Ÿ",
  "answer": "å—¯ï¼Œæˆ‘æ ¹æ®ä¸šåŠ¡éœ€æ±‚è®¾ç½®çš„ï¼Œæ¯”å¦‚sessionæ˜¯30åˆ†é’Ÿï¼Œç„¶åçƒ­ç‚¹æ•°æ®æ˜¯1å°æ—¶ã€‚è¿˜ä¼šæ ¹æ®è®¿é—®é¢‘ç‡åŠ¨æ€è°ƒæ•´ã€‚",
  "context": {
    "follow_up_depth": 2,
    "hesitation_score": 0.35,       // â† è½»å¾®çŠ¹è±«
    "filler_count": 3,              // â† æœ‰å¡«å……è¯
    "filler_words": ["å—¯", "ç„¶å"],
    "speech_rate": 3.8,             // â† è¯­é€Ÿæ­£å¸¸
    "pause_count": 0,               // â† æ— é•¿åœé¡¿
    "long_pauses": [],
    "answer_length": 80
  },
  "label": "FOLLOW_UP",
  "reason": "è™½ç„¶æœ‰å¡«å……è¯ï¼Œä½†hesitation_scoreé€‚ä¸­ï¼Œå›ç­”æœ‰å®è´¨å†…å®¹ï¼Œå¯ä»¥ç»§ç»­è¿½é—®"
}
```

**å¯¹åº”çš„å®é™…éŸ³é¢‘**ï¼š
```
æ—¶é—´è½´ï¼š|-å—¯-æˆ‘æ ¹æ®ä¸šåŠ¡éœ€æ±‚--|--æ¯”å¦‚sessionæ˜¯30åˆ†é’Ÿ--|--ç„¶åçƒ­ç‚¹æ•°æ®--|--...|
å¡«å……è¯ï¼šå—¯ã€ç„¶åï¼ˆ3ä¸ªï¼Œæ­£å¸¸ï¼‰
åœé¡¿ï¼š  æ— 
è¯„ä¼°ï¼š  âœ… æœ‰æ€è€ƒä½†ç­”å¾—å‡ºæ¥
```

---

## ğŸ”§ BERTè¾“å…¥ç‰¹å¾è®¾è®¡

### **æ–¹æ¡ˆ1ï¼šå…³é”®ç‰¹å¾ï¼ˆæ¨èï¼‰**

```python
# BERTæ¨¡å‹è¾“å…¥
input_text = f"""
[é—®é¢˜] {question}
[å›ç­”] {answer}
[çŠ¹è±«åº¦] {hesitation_score:.2f}
[å¡«å……è¯] {filler_count}ä¸ª
[æ·±åº¦] {follow_up_depth}
"""

# ç¤ºä¾‹
input_text = """
[é—®é¢˜] ä½ ç”¨è¿‡Rediså—ï¼Ÿ
[å›ç­”] å—¯...è¿™ä¸ª...æˆ‘å¥½åƒä¸å¤ªæ¸…æ¥š
[çŠ¹è±«åº¦] 0.85
[å¡«å……è¯] 6ä¸ª
[æ·±åº¦] 1
"""
# â†’ BERTè¾“å‡ºï¼šNEXT_TOPIC
```

### **æ–¹æ¡ˆ2ï¼šå®Œæ•´ç‰¹å¾**

```python
input_text = f"""
é—®é¢˜ï¼š{question}
å›ç­”ï¼š{answer}
===è¯­éŸ³åˆ†æ===
çŠ¹è±«åº¦ï¼š{hesitation_score}
å¡«å……è¯ï¼š{filler_count}ä¸ª ({', '.join(filler_words)})
è¯­é€Ÿï¼š{speech_rate}å­—/ç§’
åœé¡¿ï¼š{pause_count}æ¬¡
é•¿åœé¡¿ï¼š{long_pauses}
===ä¸Šä¸‹æ–‡===
è¿½é—®æ·±åº¦ï¼š{follow_up_depth}
å›ç­”é•¿åº¦ï¼š{answer_length}å­—
"""
```

---

## ğŸ“Š ç‰¹å¾é‡è¦æ€§æ’åº

æ ¹æ®å®é™…ç»éªŒï¼š

| ç‰¹å¾ | é‡è¦æ€§ | è¯´æ˜ |
|------|--------|------|
| **hesitation_score** | â­â­â­â­â­ | æœ€å…³é”®ï¼Œç»¼åˆè¯„åˆ† |
| **filler_count** | â­â­â­â­ | ç›´è§‚åæ˜ çŠ¹è±« |
| **answer_length** | â­â­â­â­ | å†…å®¹æ˜¯å¦å……å® |
| **follow_up_depth** | â­â­â­â­ | æ§åˆ¶è¿½é—®å±‚æ•° |
| **long_pauses** | â­â­â­ | è¾…åŠ©åˆ¤æ–­ |
| **speech_rate** | â­â­ | å¯é€‰ |
| **filler_words** | â­â­ | ç»†èŠ‚åˆ†æ |

**æœ€å°ç‰¹å¾é›†**ï¼ˆè¶³å¤Ÿå¥½ï¼‰ï¼š
```json
{
  "hesitation_score": 0.65,
  "filler_count": 5,
  "answer_length": 30,
  "follow_up_depth": 2
}
```

---

## ğŸ’¡ è®­ç»ƒæ•°æ®ç”Ÿæˆå»ºè®®

### **æ–¹æ³•1ï¼šçœŸå®è¯­éŸ³å½•åˆ¶**

```python
# 1. å½•åˆ¶çœŸå®é¢è¯•éŸ³é¢‘
# 2. ç”¨SpeechProcessorå¤„ç†
processor = SpeechProcessor(config)
result = processor.transcribe_with_analysis("interview_audio.wav")

# 3. æå–ç‰¹å¾
training_sample = {
    "question": "ä½ ç”¨è¿‡Rediså—ï¼Ÿ",
    "answer": result["text"],
    "context": {
        "hesitation_score": result["hesitation_score"],
        "filler_count": result["filler_count"],
        "answer_length": len(result["text"]),
        "follow_up_depth": 1
    },
    "label": "NEXT_TOPIC"  # äººå·¥æ ‡æ³¨
}
```

### **æ–¹æ³•2ï¼šæ¨¡æ‹Ÿç”Ÿæˆ**

```python
# æ ¹æ®ä¸åŒåœºæ™¯ï¼Œæ¨¡æ‹ŸçœŸå®çš„è¯­éŸ³ç‰¹å¾

# åœºæ™¯Aï¼šç­”å¾—å¥½
answer_good = {
    "hesitation_score": random.uniform(0.1, 0.3),
    "filler_count": random.randint(0, 2),
    "answer_length": random.randint(60, 150)
}

# åœºæ™¯Bï¼šä¸€èˆ¬
answer_ok = {
    "hesitation_score": random.uniform(0.3, 0.5),
    "filler_count": random.randint(2, 5),
    "answer_length": random.randint(30, 60)
}

# åœºæ™¯Cï¼šç­”ä¸ä¸Šæ¥
answer_bad = {
    "hesitation_score": random.uniform(0.7, 0.95),
    "filler_count": random.randint(6, 12),
    "answer_length": random.randint(10, 30)
}
```

---

## ğŸ¯ æ€»ç»“

### **å…³é”®ç‚¹**

1. **hesitation_score** æ˜¯æœ€é‡è¦çš„ç‰¹å¾
2. **filler_count** ç›´æ¥åæ˜ çŠ¹è±«ç¨‹åº¦
3. **long_pauses** å¯ä»¥è¾…åŠ©åˆ¤æ–­"å¡å£³"
4. è®­ç»ƒæ•°æ®ä¸­çš„ç‰¹å¾å€¼è¦**ç¬¦åˆçœŸå®è¯­éŸ³**çš„èŒƒå›´

### **ç‰¹å¾èŒƒå›´å‚è€ƒ**

```
æµç•…å›ç­”ï¼š
  hesitation_score: 0.1-0.3
  filler_count: 0-2
  speech_rate: 3.5-5.0

ä¸€èˆ¬å›ç­”ï¼š
  hesitation_score: 0.3-0.5
  filler_count: 2-5
  speech_rate: 2.8-3.5

ç­”ä¸ä¸Šæ¥ï¼š
  hesitation_score: 0.7-0.95
  filler_count: 6-15
  speech_rate: 1.5-2.5
```

