<!DOCTYPE html>
<html>
<head>
    <title>简化认证系统测试</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; }
        input, textarea, button { margin: 5px; padding: 8px; }
        button { background: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin: 10px 0; padding: 10px; background: #f8f9fa; border-left: 4px solid #007bff; }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .success { border-left-color: #28a745; background: #d4edda; }
    </style>
</head>
<body>
    <h1>简化认证系统测试</h1>
    
    <!-- 用户注册 -->
    <div class="section">
        <h2>用户注册</h2>
        <input type="text" id="regUsername" placeholder="用户名" value="testuser">
        <input type="password" id="regPassword" placeholder="密码" value="123456">
        <input type="password" id="regConfirmPassword" placeholder="确认密码" value="123456">
        <input type="email" id="regEmail" placeholder="邮箱" value="test@example.com">
        <input type="text" id="regRealName" placeholder="真实姓名" value="测试用户">
        <select id="regRole">
            <option value="STUDENT">学生</option>
            <option value="TEACHER">教师</option>
        </select>
        <button onclick="register()">注册</button>
        <div id="registerResult" class="result" style="display:none;"></div>
    </div>

    <!-- 用户登录 -->
    <div class="section">
        <h2>用户登录</h2>
        <input type="text" id="loginUsername" placeholder="用户名" value="testuser">
        <input type="password" id="loginPassword" placeholder="密码" value="123456">
        <button onclick="login()">登录</button>
        <div id="loginResult" class="result" style="display:none;"></div>
    </div>

    <!-- 获取用户信息 -->
    <div class="section">
        <h2>获取用户信息</h2>
        <button onclick="getUserInfo()">获取当前用户信息</button>
        <div id="userInfoResult" class="result" style="display:none;"></div>
    </div>

    <!-- 修改密码 -->
    <div class="section">
        <h2>修改密码</h2>
        <input type="password" id="oldPassword" placeholder="原密码" value="123456">
        <input type="password" id="newPassword" placeholder="新密码" value="123456789">
        <input type="password" id="confirmNewPassword" placeholder="确认新密码" value="123456789">
        <button onclick="changePassword()">修改密码</button>
        <div id="changePasswordResult" class="result" style="display:none;"></div>
    </div>

    <!-- 用户登出 -->
    <div class="section">
        <h2>用户登出</h2>
        <button onclick="logout()">登出</button>
        <div id="logoutResult" class="result" style="display:none;"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080';

        function showResult(elementId, message, isError = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = isError ? 'result error' : 'result success';
            element.innerHTML = message;
        }

        async function register() {
            const data = {
                username: document.getElementById('regUsername').value,
                password: document.getElementById('regPassword').value,
                confirmPassword: document.getElementById('regConfirmPassword').value,
                email: document.getElementById('regEmail').value,
                realName: document.getElementById('regRealName').value,
                role: document.getElementById('regRole').value
            };

            try {
                const response = await fetch(`${API_BASE}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                showResult('registerResult', JSON.stringify(result, null, 2), !result.success);
            } catch (error) {
                showResult('registerResult', '请求失败: ' + error.message, true);
            }
        }

        async function login() {
            const data = {
                username: document.getElementById('loginUsername').value,
                password: document.getElementById('loginPassword').value
            };

            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                showResult('loginResult', JSON.stringify(result, null, 2), !result.success);
            } catch (error) {
                showResult('loginResult', '请求失败: ' + error.message, true);
            }
        }

        async function getUserInfo() {
            try {
                const response = await fetch(`${API_BASE}/auth/user-info`, {
                    method: 'GET',
                    credentials: 'include'
                });

                const result = await response.json();
                showResult('userInfoResult', JSON.stringify(result, null, 2), !result.success);
            } catch (error) {
                showResult('userInfoResult', '请求失败: ' + error.message, true);
            }
        }

        async function changePassword() {
            const data = {
                oldPassword: document.getElementById('oldPassword').value,
                newPassword: document.getElementById('newPassword').value,
                confirmPassword: document.getElementById('confirmNewPassword').value
            };

            try {
                const response = await fetch(`${API_BASE}/auth/change-password`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                showResult('changePasswordResult', JSON.stringify(result, null, 2), !result.success);
            } catch (error) {
                showResult('changePasswordResult', '请求失败: ' + error.message, true);
            }
        }

        async function logout() {
            try {
                const response = await fetch(`${API_BASE}/auth/logout`, {
                    method: 'POST',
                    credentials: 'include'
                });

                const result = await response.json();
                showResult('logoutResult', JSON.stringify(result, null, 2), !result.success);
            } catch (error) {
                showResult('logoutResult', '请求失败: ' + error.message, true);
            }
        }
    </script>
</body>
</html> 