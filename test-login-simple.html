<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>简化登录测试</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select, button {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        button {
            background: #1890ff;
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover {
            background: #40a9ff;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            background: #f0f0f0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success { background: #f6ffed; border: 1px solid #b7eb8f; }
        .error { background: #fff2f0; border: 1px solid #ffccc7; }
        .buttons {
            display: flex;
            gap: 10px;
        }
        .buttons button {
            flex: 1;
        }
        h1 { color: #1890ff; text-align: center; }
        h2 { color: #666; border-bottom: 2px solid #1890ff; padding-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔐 简化登录测试</h1>
        
        <div class="form-section">
            <h2>登录测试</h2>
            <div class="form-group">
                <label>用户名:</label>
                <input type="text" id="username" value="admin" placeholder="输入用户名">
            </div>
            <div class="form-group">
                <label>密码:</label>
                <input type="password" id="password" value="admin123" placeholder="输入密码">
            </div>
            <div class="form-group">
                <label>角色:</label>
                <select id="role">
                    <option value="TEACHER">教师</option>
                    <option value="STUDENT">学生</option>
                </select>
            </div>
            <div class="buttons">
                <button onclick="testLogin()">测试登录</button>
                <button onclick="testUserInfo()">检查用户信息</button>
                <button onclick="testLogout()">测试退出</button>
            </div>
        </div>

        <div class="form-section">
            <h2>注册测试</h2>
            <div class="form-group">
                <label>用户名:</label>
                <input type="text" id="regUsername" value="" placeholder="输入用户名">
            </div>
            <div class="form-group">
                <label>真实姓名:</label>
                <input type="text" id="regRealName" value="" placeholder="输入真实姓名">
            </div>
            <div class="form-group">
                <label>邮箱:</label>
                <input type="email" id="regEmail" value="" placeholder="输入邮箱">
            </div>
            <div class="form-group">
                <label>密码:</label>
                <input type="password" id="regPassword" value="123456" placeholder="输入密码">
            </div>
            <div class="form-group">
                <label>角色:</label>
                <select id="regRole">
                    <option value="STUDENT">学生</option>
                    <option value="TEACHER">教师</option>
                </select>
            </div>
            <div class="buttons">
                <button onclick="testRegister()">测试注册</button>
                <button onclick="fillRandomData()">填写随机数据</button>
            </div>
        </div>

        <div class="form-section">
            <h2>状态管理</h2>
            <div class="buttons">
                <button onclick="clearAllData()">清除所有数据</button>
                <button onclick="checkStatus()">检查状态</button>
                <button onclick="testFrontend()">测试前端页面</button>
            </div>
        </div>

        <div id="result" class="result"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080';
        const FRONTEND_BASE = 'http://localhost:5173';

        function showResult(content, type = 'info') {
            const result = document.getElementById('result');
            result.textContent = content;
            result.className = `result ${type}`;
        }

        // 测试登录
        async function testLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const role = document.getElementById('role').value;

            if (!username || !password) {
                showResult('请填写用户名和密码', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({ username, password, role })
                });

                const result = await response.json();
                
                if (result.success) {
                    showResult(`✅ 登录成功！
用户信息: ${JSON.stringify(result.data.userInfo, null, 2)}
状态码: ${response.status}`, 'success');
                } else {
                    showResult(`❌ 登录失败: ${result.message}
状态码: ${response.status}`, 'error');
                }
            } catch (error) {
                showResult(`❌ 登录错误: ${error.message}`, 'error');
            }
        }

        // 测试用户信息
        async function testUserInfo() {
            try {
                const response = await fetch(`${API_BASE}/auth/user-info`, {
                    method: 'GET',
                    credentials: 'include'
                });

                const result = await response.json();
                
                if (result.success) {
                    showResult(`✅ 用户信息获取成功！
用户信息: ${JSON.stringify(result.data.userInfo, null, 2)}
状态码: ${response.status}`, 'success');
                } else {
                    showResult(`⚠️ 用户信息: ${result.message}
状态码: ${response.status}`, 'error');
                }
            } catch (error) {
                showResult(`❌ 用户信息错误: ${error.message}`, 'error');
            }
        }

        // 测试退出
        async function testLogout() {
            try {
                const response = await fetch(`${API_BASE}/auth/logout`, {
                    method: 'POST',
                    credentials: 'include'
                });

                const result = await response.json();
                
                showResult(`✅ 退出成功！
响应: ${JSON.stringify(result, null, 2)}
状态码: ${response.status}`, 'success');
            } catch (error) {
                showResult(`❌ 退出错误: ${error.message}`, 'error');
            }
        }

        // 测试注册
        async function testRegister() {
            const username = document.getElementById('regUsername').value;
            const realName = document.getElementById('regRealName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const role = document.getElementById('regRole').value;

            if (!username || !realName || !email || !password) {
                showResult('请填写所有注册信息', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        username,
                        realName,
                        email,
                        password,
                        confirmPassword: password,
                        role
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    showResult(`✅ 注册成功！
响应: ${JSON.stringify(result, null, 2)}
状态码: ${response.status}`, 'success');
                } else {
                    showResult(`❌ 注册失败: ${result.message}
状态码: ${response.status}`, 'error');
                }
            } catch (error) {
                showResult(`❌ 注册错误: ${error.message}`, 'error');
            }
        }

        // 填写随机数据
        function fillRandomData() {
            const timestamp = Date.now();
            document.getElementById('regUsername').value = `user_${timestamp}`;
            document.getElementById('regRealName').value = `测试用户_${timestamp}`;
            document.getElementById('regEmail').value = `test_${timestamp}@example.com`;
        }

        // 清除所有数据
        function clearAllData() {
            // 清除 localStorage
            localStorage.clear();
            
            // 清除 sessionStorage
            sessionStorage.clear();
            
            // 清除 cookies
            document.cookie.split(";").forEach(function(c) { 
                document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
            });
            
            showResult('✅ 已清除所有本地数据（localStorage, sessionStorage, cookies）', 'success');
        }

        // 检查状态
        function checkStatus() {
            const status = {
                localStorage: {
                    keys: Object.keys(localStorage),
                    userInfo: localStorage.getItem('userInfo'),
                    token: localStorage.getItem('token'),
                    sessionId: localStorage.getItem('sessionId')
                },
                cookies: document.cookie,
                sessionStorage: {
                    keys: Object.keys(sessionStorage)
                }
            };

            showResult(`当前状态检查:
${JSON.stringify(status, null, 2)}`, 'info');
        }

        // 测试前端页面
        function testFrontend() {
            const pages = [
                { name: '首页', url: `${FRONTEND_BASE}/home` },
                { name: '登录页', url: `${FRONTEND_BASE}/login` },
                { name: '注册页', url: `${FRONTEND_BASE}/register` }
            ];

            let message = '前端页面测试链接：\n\n';
            pages.forEach(page => {
                message += `${page.name}: ${page.url}\n`;
            });
            message += '\n点击下面的链接测试各个页面：';

            showResult(message, 'info');

            // 添加可点击链接
            const result = document.getElementById('result');
            pages.forEach(page => {
                const link = document.createElement('a');
                link.href = page.url;
                link.target = '_blank';
                link.textContent = page.name;
                link.style.display = 'inline-block';
                link.style.margin = '10px';
                link.style.padding = '10px 20px';
                link.style.background = '#1890ff';
                link.style.color = 'white';
                link.style.textDecoration = 'none';
                link.style.borderRadius = '5px';
                result.appendChild(document.createElement('br'));
                result.appendChild(link);
            });
        }
    </script>
</body>
</html> 