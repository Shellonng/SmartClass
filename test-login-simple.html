<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€åŒ–ç™»å½•æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select, button {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        button {
            background: #1890ff;
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover {
            background: #40a9ff;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            background: #f0f0f0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success { background: #f6ffed; border: 1px solid #b7eb8f; }
        .error { background: #fff2f0; border: 1px solid #ffccc7; }
        .buttons {
            display: flex;
            gap: 10px;
        }
        .buttons button {
            flex: 1;
        }
        h1 { color: #1890ff; text-align: center; }
        h2 { color: #666; border-bottom: 2px solid #1890ff; padding-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ç®€åŒ–ç™»å½•æµ‹è¯•</h1>
        
        <div class="form-section">
            <h2>ç™»å½•æµ‹è¯•</h2>
            <div class="form-group">
                <label>ç”¨æˆ·å:</label>
                <input type="text" id="username" value="admin" placeholder="è¾“å…¥ç”¨æˆ·å">
            </div>
            <div class="form-group">
                <label>å¯†ç :</label>
                <input type="password" id="password" value="admin123" placeholder="è¾“å…¥å¯†ç ">
            </div>
            <div class="form-group">
                <label>è§’è‰²:</label>
                <select id="role">
                    <option value="TEACHER">æ•™å¸ˆ</option>
                    <option value="STUDENT">å­¦ç”Ÿ</option>
                </select>
            </div>
            <div class="buttons">
                <button onclick="testLogin()">æµ‹è¯•ç™»å½•</button>
                <button onclick="testUserInfo()">æ£€æŸ¥ç”¨æˆ·ä¿¡æ¯</button>
                <button onclick="testLogout()">æµ‹è¯•é€€å‡º</button>
            </div>
        </div>

        <div class="form-section">
            <h2>æ³¨å†Œæµ‹è¯•</h2>
            <div class="form-group">
                <label>ç”¨æˆ·å:</label>
                <input type="text" id="regUsername" value="" placeholder="è¾“å…¥ç”¨æˆ·å">
            </div>
            <div class="form-group">
                <label>çœŸå®å§“å:</label>
                <input type="text" id="regRealName" value="" placeholder="è¾“å…¥çœŸå®å§“å">
            </div>
            <div class="form-group">
                <label>é‚®ç®±:</label>
                <input type="email" id="regEmail" value="" placeholder="è¾“å…¥é‚®ç®±">
            </div>
            <div class="form-group">
                <label>å¯†ç :</label>
                <input type="password" id="regPassword" value="123456" placeholder="è¾“å…¥å¯†ç ">
            </div>
            <div class="form-group">
                <label>è§’è‰²:</label>
                <select id="regRole">
                    <option value="STUDENT">å­¦ç”Ÿ</option>
                    <option value="TEACHER">æ•™å¸ˆ</option>
                </select>
            </div>
            <div class="buttons">
                <button onclick="testRegister()">æµ‹è¯•æ³¨å†Œ</button>
                <button onclick="fillRandomData()">å¡«å†™éšæœºæ•°æ®</button>
            </div>
        </div>

        <div class="form-section">
            <h2>çŠ¶æ€ç®¡ç†</h2>
            <div class="buttons">
                <button onclick="clearAllData()">æ¸…é™¤æ‰€æœ‰æ•°æ®</button>
                <button onclick="checkStatus()">æ£€æŸ¥çŠ¶æ€</button>
                <button onclick="testFrontend()">æµ‹è¯•å‰ç«¯é¡µé¢</button>
            </div>
        </div>

        <div id="result" class="result"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080';
        const FRONTEND_BASE = 'http://localhost:5173';

        function showResult(content, type = 'info') {
            const result = document.getElementById('result');
            result.textContent = content;
            result.className = `result ${type}`;
        }

        // æµ‹è¯•ç™»å½•
        async function testLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const role = document.getElementById('role').value;

            if (!username || !password) {
                showResult('è¯·å¡«å†™ç”¨æˆ·åå’Œå¯†ç ', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({ username, password, role })
                });

                const result = await response.json();
                
                if (result.success) {
                    showResult(`âœ… ç™»å½•æˆåŠŸï¼
ç”¨æˆ·ä¿¡æ¯: ${JSON.stringify(result.data.userInfo, null, 2)}
çŠ¶æ€ç : ${response.status}`, 'success');
                } else {
                    showResult(`âŒ ç™»å½•å¤±è´¥: ${result.message}
çŠ¶æ€ç : ${response.status}`, 'error');
                }
            } catch (error) {
                showResult(`âŒ ç™»å½•é”™è¯¯: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•ç”¨æˆ·ä¿¡æ¯
        async function testUserInfo() {
            try {
                const response = await fetch(`${API_BASE}/auth/user-info`, {
                    method: 'GET',
                    credentials: 'include'
                });

                const result = await response.json();
                
                if (result.success) {
                    showResult(`âœ… ç”¨æˆ·ä¿¡æ¯è·å–æˆåŠŸï¼
ç”¨æˆ·ä¿¡æ¯: ${JSON.stringify(result.data.userInfo, null, 2)}
çŠ¶æ€ç : ${response.status}`, 'success');
                } else {
                    showResult(`âš ï¸ ç”¨æˆ·ä¿¡æ¯: ${result.message}
çŠ¶æ€ç : ${response.status}`, 'error');
                }
            } catch (error) {
                showResult(`âŒ ç”¨æˆ·ä¿¡æ¯é”™è¯¯: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•é€€å‡º
        async function testLogout() {
            try {
                const response = await fetch(`${API_BASE}/auth/logout`, {
                    method: 'POST',
                    credentials: 'include'
                });

                const result = await response.json();
                
                showResult(`âœ… é€€å‡ºæˆåŠŸï¼
å“åº”: ${JSON.stringify(result, null, 2)}
çŠ¶æ€ç : ${response.status}`, 'success');
            } catch (error) {
                showResult(`âŒ é€€å‡ºé”™è¯¯: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•æ³¨å†Œ
        async function testRegister() {
            const username = document.getElementById('regUsername').value;
            const realName = document.getElementById('regRealName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const role = document.getElementById('regRole').value;

            if (!username || !realName || !email || !password) {
                showResult('è¯·å¡«å†™æ‰€æœ‰æ³¨å†Œä¿¡æ¯', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        username,
                        realName,
                        email,
                        password,
                        confirmPassword: password,
                        role
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    showResult(`âœ… æ³¨å†ŒæˆåŠŸï¼
å“åº”: ${JSON.stringify(result, null, 2)}
çŠ¶æ€ç : ${response.status}`, 'success');
                } else {
                    showResult(`âŒ æ³¨å†Œå¤±è´¥: ${result.message}
çŠ¶æ€ç : ${response.status}`, 'error');
                }
            } catch (error) {
                showResult(`âŒ æ³¨å†Œé”™è¯¯: ${error.message}`, 'error');
            }
        }

        // å¡«å†™éšæœºæ•°æ®
        function fillRandomData() {
            const timestamp = Date.now();
            document.getElementById('regUsername').value = `user_${timestamp}`;
            document.getElementById('regRealName').value = `æµ‹è¯•ç”¨æˆ·_${timestamp}`;
            document.getElementById('regEmail').value = `test_${timestamp}@example.com`;
        }

        // æ¸…é™¤æ‰€æœ‰æ•°æ®
        function clearAllData() {
            // æ¸…é™¤ localStorage
            localStorage.clear();
            
            // æ¸…é™¤ sessionStorage
            sessionStorage.clear();
            
            // æ¸…é™¤ cookies
            document.cookie.split(";").forEach(function(c) { 
                document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
            });
            
            showResult('âœ… å·²æ¸…é™¤æ‰€æœ‰æœ¬åœ°æ•°æ®ï¼ˆlocalStorage, sessionStorage, cookiesï¼‰', 'success');
        }

        // æ£€æŸ¥çŠ¶æ€
        function checkStatus() {
            const status = {
                localStorage: {
                    keys: Object.keys(localStorage),
                    userInfo: localStorage.getItem('userInfo'),
                    token: localStorage.getItem('token'),
                    sessionId: localStorage.getItem('sessionId')
                },
                cookies: document.cookie,
                sessionStorage: {
                    keys: Object.keys(sessionStorage)
                }
            };

            showResult(`å½“å‰çŠ¶æ€æ£€æŸ¥:
${JSON.stringify(status, null, 2)}`, 'info');
        }

        // æµ‹è¯•å‰ç«¯é¡µé¢
        function testFrontend() {
            const pages = [
                { name: 'é¦–é¡µ', url: `${FRONTEND_BASE}/home` },
                { name: 'ç™»å½•é¡µ', url: `${FRONTEND_BASE}/login` },
                { name: 'æ³¨å†Œé¡µ', url: `${FRONTEND_BASE}/register` }
            ];

            let message = 'å‰ç«¯é¡µé¢æµ‹è¯•é“¾æ¥ï¼š\n\n';
            pages.forEach(page => {
                message += `${page.name}: ${page.url}\n`;
            });
            message += '\nç‚¹å‡»ä¸‹é¢çš„é“¾æ¥æµ‹è¯•å„ä¸ªé¡µé¢ï¼š';

            showResult(message, 'info');

            // æ·»åŠ å¯ç‚¹å‡»é“¾æ¥
            const result = document.getElementById('result');
            pages.forEach(page => {
                const link = document.createElement('a');
                link.href = page.url;
                link.target = '_blank';
                link.textContent = page.name;
                link.style.display = 'inline-block';
                link.style.margin = '10px';
                link.style.padding = '10px 20px';
                link.style.background = '#1890ff';
                link.style.color = 'white';
                link.style.textDecoration = 'none';
                link.style.borderRadius = '5px';
                result.appendChild(document.createElement('br'));
                result.appendChild(link);
            });
        }
    </script>
</body>
</html> 